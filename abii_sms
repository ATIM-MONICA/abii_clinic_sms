import os
from dotenv import load_dotenv
import africastalking

# Load environment variables
load_dotenv()

# Retrieve credentials
username = os.getenv("AT_USERNAME")
api_key = os.getenv("AT_API_KEY")
sender_id = os.getenv("AT_SENDER_ID")

# Initialize Africa's Talking
africastalking.initialize(username, api_key)
sms = africastalking.SMS

# Send test message
recipients = ["+256782569360","0726750061"]


# Separate valid +256 numbers and invalid ones
valid_recipients = [p for p in recipients if p.startswith("+256")]
invalid_recipients = [p for p in recipients if not p.startswith("+256")]

# Log invalid numbers for review
if invalid_recipients:
    print("âš  The following numbers are NOT Ugandan (+256) and were skipped:")
    for num in invalid_recipients:
        print(" -", num)

if not valid_recipients:
    print("No valid +256 (Uganda) numbers found. SMS not sent to avoid charges.")
else:
    message = "Hello from ABII Clinic! Your appointment reminder is being tested."
    try:
        response = sms.send(message, valid_recipients, sender_id)
        print("Response:", response)
    except Exception as e:
        print(f"Error: {e}")


